<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Diagnostic Tool - CareLuva</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .diagnostic-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .result {
            margin-top: 10px;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        .error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        .warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #f59e0b;
        }
        .info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #10b981; }
        .status-error { background: #ef4444; }
        .status-warning { background: #f59e0b; }
        .status-unknown { background: #6b7280; }
    </style>
</head>
<body>
    <div class="diagnostic-container">
        <h1>üî• Firebase Diagnostic Tool</h1>
        <p>This tool helps diagnose Firebase connection issues in the CareLuva application.</p>
        
        <div class="test-section">
            <h3>1. Network Connectivity Test</h3>
            <button class="test-button" onclick="testNetworkConnectivity()">Test Network</button>
            <div id="network-result" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>2. Firebase SDK Loading Test</h3>
            <button class="test-button" onclick="testFirebaseSDK()">Test SDK Loading</button>
            <div id="sdk-result" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>3. Firebase Configuration Test</h3>
            <button class="test-button" onclick="testFirebaseConfig()">Test Configuration</button>
            <div id="config-result" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>4. Firebase Authentication Test</h3>
            <button class="test-button" onclick="testFirebaseAuth()">Test Auth</button>
            <div id="auth-result" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>5. Firebase Firestore Test</h3>
            <button class="test-button" onclick="testFirestore()">Test Firestore</button>
            <div id="firestore-result" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>6. Complete Integration Test</h3>
            <button class="test-button" onclick="runCompleteTest()">Run All Tests</button>
            <div id="complete-result" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>7. Troubleshooting Solutions</h3>
            <div id="solutions" style="display: none;">
                <h4>Common Solutions:</h4>
                <ul>
                    <li><strong>Network Issues:</strong> Check internet connection and firewall settings</li>
                    <li><strong>Firebase Project:</strong> Verify project ID and configuration</li>
                    <li><strong>Browser Issues:</strong> Try different browser or clear cache</li>
                    <li><strong>CORS Issues:</strong> Check if localhost is in Firebase authorized domains</li>
                    <li><strong>Firebase Rules:</strong> Verify Firestore security rules</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let testResults = {};
        
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${type}`;
            element.textContent = message;
        }
        
        function getStatusIndicator(status) {
            const indicators = {
                'success': 'status-success',
                'error': 'status-error',
                'warning': 'status-warning',
                'unknown': 'status-unknown'
            };
            return `<span class="status-indicator ${indicators[status] || 'status-unknown'}"></span>`;
        }
        
        async function testNetworkConnectivity() {
            const results = [];
            let status = 'success';
            
            try {
                // Test basic connectivity
                results.push('Testing basic internet connectivity...');
                const response = await fetch('https://www.google.com', { 
                    method: 'HEAD', 
                    mode: 'no-cors',
                    cache: 'no-cache'
                });
                results.push('‚úÖ Basic internet connectivity: OK');
                
                // Test Firebase domains
                results.push('\nTesting Firebase domain connectivity...');
                
                const firebaseDomains = [
                    'https://firebaseapp.com',
                    'https://firestore.googleapis.com',
                    'https://identitytoolkit.googleapis.com'
                ];
                
                for (const domain of firebaseDomains) {
                    try {
                        await fetch(domain, { 
                            method: 'HEAD', 
                            mode: 'no-cors',
                            cache: 'no-cache'
                        });
                        results.push(`‚úÖ ${domain}: Accessible`);
                    } catch (error) {
                        results.push(`‚ùå ${domain}: ${error.message}`);
                        status = 'warning';
                    }
                }
                
                // Test DNS resolution
                results.push('\nTesting DNS resolution...');
                try {
                    const dnsTest = await fetch('https://dns.google/resolve?name=firebaseapp.com&type=A', {
                        cache: 'no-cache'
                    });
                    results.push('‚úÖ DNS resolution: OK');
                } catch (error) {
                    results.push(`‚ùå DNS resolution: ${error.message}`);
                    status = 'warning';
                }
                
            } catch (error) {
                results.push(`‚ùå Network test failed: ${error.message}`);
                status = 'error';
            }
            
            testResults.network = status;
            showResult('network-result', results.join('\n'), status);
        }
        
        async function testFirebaseSDK() {
            const results = [];
            let status = 'success';
            
            try {
                results.push('Testing Firebase SDK loading...');
                
                // Test if Firebase modules can be imported
                const modules = [
                    'https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js',
                    'https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js',
                    'https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js'
                ];
                
                for (const module of modules) {
                    try {
                        const response = await fetch(module, { cache: 'no-cache' });
                        if (response.ok) {
                            results.push(`‚úÖ ${module}: Loadable`);
                        } else {
                            results.push(`‚ùå ${module}: HTTP ${response.status}`);
                            status = 'error';
                        }
                    } catch (error) {
                        results.push(`‚ùå ${module}: ${error.message}`);
                        status = 'error';
                    }
                }
                
                // Test dynamic import
                try {
                    results.push('\nTesting dynamic imports...');
                    const { initializeApp } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js');
                    results.push('‚úÖ Firebase App module: Importable');
                    
                    const { getAuth } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js');
                    results.push('‚úÖ Firebase Auth module: Importable');
                    
                    const { getFirestore } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js');
                    results.push('‚úÖ Firebase Firestore module: Importable');
                    
                } catch (error) {
                    results.push(`‚ùå Dynamic import failed: ${error.message}`);
                    status = 'error';
                }
                
            } catch (error) {
                results.push(`‚ùå SDK test failed: ${error.message}`);
                status = 'error';
            }
            
            testResults.sdk = status;
            showResult('sdk-result', results.join('\n'), status);
        }
        
        async function testFirebaseConfig() {
            const results = [];
            let status = 'success';
            
            try {
                results.push('Testing Firebase configuration...');
                
                const firebaseConfig = {
                    apiKey: "AIzaSyCXGpGiAaXwWMt-UoMl0hgBVxKddRHN8n0",
                    authDomain: "careluva-5635e.firebaseapp.com",
                    projectId: "careluva-5635e",
                    storageBucket: "careluva-5635e.firebasestorage.app",
                    messagingSenderId: "819482287777",
                    appId: "1:819482287777:web:7587b10272cacc0e655ae0",
                    measurementId: "G-9DL8W0Q6PB"
                };
                
                // Validate configuration
                results.push('Configuration validation:');
                results.push(`‚úÖ API Key: ${firebaseConfig.apiKey ? 'Present' : 'Missing'}`);
                results.push(`‚úÖ Auth Domain: ${firebaseConfig.authDomain}`);
                results.push(`‚úÖ Project ID: ${firebaseConfig.projectId}`);
                results.push(`‚úÖ Storage Bucket: ${firebaseConfig.storageBucket}`);
                results.push(`‚úÖ Messaging Sender ID: ${firebaseConfig.messagingSenderId}`);
                results.push(`‚úÖ App ID: ${firebaseConfig.appId}`);
                
                // Test Firebase initialization
                try {
                    results.push('\nTesting Firebase initialization...');
                    const { initializeApp } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js');
                    const app = initializeApp(firebaseConfig);
                    results.push('‚úÖ Firebase app initialized successfully');
                    
                    // Test Auth initialization
                    const { getAuth } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js');
                    const auth = getAuth(app);
                    results.push('‚úÖ Firebase Auth initialized successfully');
                    
                    // Test Firestore initialization
                    const { getFirestore } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js');
                    const db = getFirestore(app);
                    results.push('‚úÖ Firebase Firestore initialized successfully');
                    
                } catch (error) {
                    results.push(`‚ùå Firebase initialization failed: ${error.message}`);
                    status = 'error';
                }
                
            } catch (error) {
                results.push(`‚ùå Configuration test failed: ${error.message}`);
                status = 'error';
            }
            
            testResults.config = status;
            showResult('config-result', results.join('\n'), status);
        }
        
        async function testFirebaseAuth() {
            const results = [];
            let status = 'success';
            
            try {
                results.push('Testing Firebase Authentication...');
                
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js');
                const { getAuth } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js');
                
                const firebaseConfig = {
                    apiKey: "AIzaSyCXGpGiAaXwWMt-UoMl0hgBVxKddRHN8n0",
                    authDomain: "careluva-5635e.firebaseapp.com",
                    projectId: "careluva-5635e",
                    storageBucket: "careluva-5635e.firebasestorage.app",
                    messagingSenderId: "819482287777",
                    appId: "1:819482287777:web:7587b10272cacc0e655ae0",
                    measurementId: "G-9DL8W0Q6PB"
                };
                
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                
                results.push('‚úÖ Auth instance created');
                results.push(`‚úÖ Current user: ${auth.currentUser ? auth.currentUser.email : 'None'}`);
                results.push(`‚úÖ Auth domain: ${auth.app.options.authDomain}`);
                
                // Test auth state
                results.push('\nTesting auth state...');
                const { onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js');
                
                return new Promise((resolve) => {
                    const unsubscribe = onAuthStateChanged(auth, (user) => {
                        if (user) {
                            results.push(`‚úÖ Auth state: User signed in (${user.email})`);
                        } else {
                            results.push('‚úÖ Auth state: No user signed in');
                        }
                        unsubscribe();
                        testResults.auth = status;
                        showResult('auth-result', results.join('\n'), status);
                        resolve();
                    });
                });
                
            } catch (error) {
                results.push(`‚ùå Auth test failed: ${error.message}`);
                status = 'error';
                testResults.auth = status;
                showResult('auth-result', results.join('\n'), status);
            }
        }
        
        async function testFirestore() {
            const results = [];
            let status = 'success';
            
            try {
                results.push('Testing Firebase Firestore...');
                
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js');
                const { getFirestore, collection, addDoc, getDocs } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js');
                
                const firebaseConfig = {
                    apiKey: "AIzaSyCXGpGiAaXwWMt-UoMl0hgBVxKddRHN8n0",
                    authDomain: "careluva-5635e.firebaseapp.com",
                    projectId: "careluva-5635e",
                    storageBucket: "careluva-5635e.firebasestorage.app",
                    messagingSenderId: "819482287777",
                    appId: "1:819482287777:web:7587b10272cacc0e655ae0",
                    measurementId: "G-9DL8W0Q6PB"
                };
                
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                
                results.push('‚úÖ Firestore instance created');
                results.push(`‚úÖ Project ID: ${db.app.options.projectId}`);
                
                // Test read operation
                results.push('\nTesting Firestore read operation...');
                try {
                    const testCollection = collection(db, 'test');
                    const snapshot = await getDocs(testCollection);
                    results.push(`‚úÖ Read test: Success (${snapshot.size} documents)`);
                } catch (error) {
                    results.push(`‚ùå Read test failed: ${error.message}`);
                    status = 'error';
                }
                
                // Test write operation
                results.push('\nTesting Firestore write operation...');
                try {
                    const testCollection = collection(db, 'test');
                    const testDoc = await addDoc(testCollection, {
                        test: true,
                        timestamp: new Date().toISOString(),
                        diagnostic: true
                    });
                    results.push(`‚úÖ Write test: Success (Document ID: ${testDoc.id})`);
                } catch (error) {
                    results.push(`‚ùå Write test failed: ${error.message}`);
                    status = 'error';
                }
                
            } catch (error) {
                results.push(`‚ùå Firestore test failed: ${error.message}`);
                status = 'error';
            }
            
            testResults.firestore = status;
            showResult('firestore-result', results.join('\n'), status);
        }
        
        async function runCompleteTest() {
            const results = [];
            results.push('Running complete Firebase diagnostic...\n');
            
            // Run all tests
            await testNetworkConnectivity();
            await testFirebaseSDK();
            await testFirebaseConfig();
            await testFirebaseAuth();
            await testFirestore();
            
            // Summary
            results.push('\n=== DIAGNOSTIC SUMMARY ===');
            results.push(`Network: ${getStatusIndicator(testResults.network || 'unknown')} ${testResults.network || 'Not tested'}`);
            results.push(`SDK: ${getStatusIndicator(testResults.sdk || 'unknown')} ${testResults.sdk || 'Not tested'}`);
            results.push(`Config: ${getStatusIndicator(testResults.config || 'unknown')} ${testResults.config || 'Not tested'}`);
            results.push(`Auth: ${getStatusIndicator(testResults.auth || 'unknown')} ${testResults.auth || 'Not tested'}`);
            results.push(`Firestore: ${getStatusIndicator(testResults.firestore || 'unknown')} ${testResults.firestore || 'Not tested'}`);
            
            // Overall status
            const allStatuses = Object.values(testResults);
            const hasErrors = allStatuses.includes('error');
            const hasWarnings = allStatuses.includes('warning');
            
            let overallStatus = 'success';
            if (hasErrors) {
                overallStatus = 'error';
                results.push('\n‚ùå CRITICAL ISSUES FOUND - Firebase connection will fail');
            } else if (hasWarnings) {
                overallStatus = 'warning';
                results.push('\n‚ö†Ô∏è WARNINGS FOUND - Firebase may have limited functionality');
            } else {
                results.push('\n‚úÖ ALL TESTS PASSED - Firebase should work correctly');
            }
            
            showResult('complete-result', results.join('\n'), overallStatus);
            
            // Show solutions if there are issues
            if (hasErrors || hasWarnings) {
                document.getElementById('solutions').style.display = 'block';
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Firebase diagnostic tool loaded');
        });
    </script>
</body>
</html>



