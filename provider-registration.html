<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provider Registration - CareLuva</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .progress-container {
            padding: 30px 40px 0;
            background: white;
        }
        
        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .progress-step {
            flex: 1;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            margin: 0 5px;
            transition: background 0.3s ease;
        }
        
        .progress-step.active {
            background: #3b82f6;
        }
        
        .progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 30px;
        }
        
        .form-container {
            padding: 0 40px 40px;
        }
        
        .form-step {
            display: none !important;
        }
        
        .form-step.active {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .form-grid {
            display: grid !important;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .form-group {
            margin-bottom: 20px;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            background: white !important;
            box-sizing: border-box;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        /* Force visibility for all form elements */
        .form-step.active * {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .form-step.active input,
        .form-step.active select,
        .form-step.active textarea {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            background: white !important;
            border: 2px solid #d1d5db !important;
            padding: 12px 16px !important;
            width: 100% !important;
            box-sizing: border-box !important;
        }
        
        .form-step.active label {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            margin-bottom: 5px !important;
            font-weight: bold !important;
            color: #333 !important;
        }
        
        .step-header {
            margin-bottom: 30px;
        }
        
        .step-header h3 {
            color: #1f2937;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }
        
        .step-header p {
            color: #6b7280;
        }
        
        .form-grid {
            display: grid !important;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .form-group {
            margin-bottom: 20px;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-top: 2px;
        }
        
        .checkbox-group label {
            margin: 0;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .language-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .language-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .language-option input[type="checkbox"] {
            width: auto;
        }
        
        .review-section {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .review-group {
            margin-bottom: 20px;
        }
        
        .review-group h4 {
            color: #1f2937;
            margin-bottom: 10px;
            font-size: 1.1rem;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 5px;
        }
        
        .review-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 14px;
        }
        
        .review-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }
        
        .review-label {
            font-weight: 500;
            color: #6b7280;
        }
        
        .review-value {
            color: #1f2937;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        .back-link {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            opacity: 0.9;
            transition: opacity 0.3s ease;
        }
        
        .back-link:hover {
            opacity: 1;
        }
        
        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .success-message {
            background: #d1fae5;
            color: #065f46;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .review-grid {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .progress-container,
            .form-container {
                padding: 20px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <a href="provider-auth.html" class="back-link">
        ← Back to Authentication
    </a>
    
    <div class="container">
        <div class="header">
            <h1>Complete Your Registration</h1>
            <p>Provide detailed information about your clinic or hospital</p>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-step active" data-step="1"></div>
                <div class="progress-step" data-step="2"></div>
                <div class="progress-step" data-step="3"></div>
                <div class="progress-step" data-step="4"></div>
                <div class="progress-step" data-step="5"></div>
            </div>
            <div class="progress-labels">
                <span>Basic Info</span>
                <span>Credentials</span>
                <span>Verification</span>
                <span>Account</span>
                <span>Review</span>
            </div>
        </div>
        
        <div class="form-container">
            <div id="messages"></div>
            
            <!-- Step 1: Basic Information -->
            <div class="form-step active" data-step="1">
                <div class="step-header">
                    <h3>Basic Information</h3>
                    <p>Tell us about your clinic or hospital</p>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="provider-type">Provider Type *</label>
                        <select id="provider-type" required>
                            <option value="">Select provider type</option>
                            <option value="clinic">Clinic</option>
                            <option value="hospital">Hospital</option>
                            <option value="dental-clinic">Dental Clinic</option>
                            <option value="cosmetic-clinic">Cosmetic Clinic</option>
                            <option value="hair-transplant-clinic">Hair Transplant Clinic</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="clinic-name">Clinic/Hospital Name *</label>
                        <input type="text" id="clinic-name" placeholder="Enter your clinic or hospital name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="contact-person">Contact Person *</label>
                        <input type="text" id="contact-person" placeholder="Full name of the main contact person" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email Address *</label>
                        <input type="email" id="email" placeholder="Enter your business email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">Phone Number *</label>
                        <input type="tel" id="phone" placeholder="+90 555 123 4567" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="city">City *</label>
                        <input type="text" id="city" placeholder="Istanbul" required>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="address">Address *</label>
                        <textarea id="address" placeholder="Enter your clinic address" rows="3" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="country">Country *</label>
                        <input type="text" id="country" placeholder="Turkey" value="Turkey" required>
                    </div>
                </div>
            </div>
            
            <!-- Step 2: Medical Credentials -->
            <div class="form-step" data-step="2">
                <div class="step-header">
                    <h3>Medical Credentials</h3>
                    <p>Upload your medical licenses and certifications</p>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="medical-license">Medical License Number *</label>
                        <input type="text" id="medical-license" placeholder="Enter your medical license number" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="specialization">Specialization *</label>
                        <select id="specialization" required>
                            <option value="">Select specialization</option>
                            <option value="general-medicine">General Medicine</option>
                            <option value="dentistry">Dentistry</option>
                            <option value="cosmetic-surgery">Cosmetic Surgery</option>
                            <option value="hair-transplant">Hair Transplant</option>
                            <option value="dermatology">Dermatology</option>
                            <option value="ophthalmology">Ophthalmology</option>
                            <option value="orthopedics">Orthopedics</option>
                            <option value="cardiology">Cardiology</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="experience-years">Years of Experience *</label>
                        <input type="number" id="experience-years" placeholder="5" min="1" max="50" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="license-file">Medical License Document *</label>
                        <input type="file" id="license-file" accept=".pdf,.jpg,.jpeg,.png" required>
                    </div>
                </div>
            </div>
            
            <!-- Step 3: Verification -->
            <div class="form-step" data-step="3">
                <div class="step-header">
                    <h3>Insurance & Verification</h3>
                    <p>Provide insurance and verification documents</p>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="malpractice-insurance">Malpractice Insurance *</label>
                        <input type="file" id="malpractice-insurance" accept=".pdf,.jpg,.jpeg,.png" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="business-license">Business License *</label>
                        <input type="file" id="business-license" accept=".pdf,.jpg,.jpeg,.png" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="clinic-photos">Clinic Photos</label>
                        <input type="file" id="clinic-photos" accept=".jpg,.jpeg,.png" multiple>
                    </div>
                    
                    <div class="form-group">
                        <label for="website">Website (Optional)</label>
                        <input type="url" id="website" placeholder="https://yourclinic.com">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Languages Spoken</label>
                    <div class="language-grid">
                        <div class="language-option">
                            <input type="checkbox" name="languages" value="turkish" id="lang-turkish">
                            <label for="lang-turkish">Turkish</label>
                        </div>
                        <div class="language-option">
                            <input type="checkbox" name="languages" value="english" id="lang-english">
                            <label for="lang-english">English</label>
                        </div>
                        <div class="language-option">
                            <input type="checkbox" name="languages" value="arabic" id="lang-arabic">
                            <label for="lang-arabic">Arabic</label>
                        </div>
                        <div class="language-option">
                            <input type="checkbox" name="languages" value="german" id="lang-german">
                            <label for="lang-german">German</label>
                        </div>
                        <div class="language-option">
                            <input type="checkbox" name="languages" value="french" id="lang-french">
                            <label for="lang-french">French</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 4: Account Setup -->
            <div class="form-step" data-step="4">
                <div class="step-header">
                    <h3>Account Setup</h3>
                    <p>Create your secure account</p>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="password">Password *</label>
                        <input type="password" id="password" placeholder="Create a strong password" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm-password">Confirm Password *</label>
                        <input type="password" id="confirm-password" placeholder="Confirm your password" required>
                    </div>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="terms-accepted" required>
                    <label for="terms-accepted">I agree to the <a href="#" style="color: #3b82f6;">Terms of Service</a> and <a href="#" style="color: #3b82f6;">Privacy Policy</a> *</label>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="marketing-consent">
                    <label for="marketing-consent">I would like to receive updates and marketing communications</label>
                </div>
            </div>
            
            <!-- Step 5: Review & Submit -->
            <div class="form-step" data-step="5">
                <div class="step-header">
                    <h3>Review & Submit</h3>
                    <p>Please review your information before submitting</p>
                </div>
                
                <div class="review-section" id="review-content">
                    <!-- Review content will be populated here -->
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" id="prev-step" class="btn btn-secondary" disabled>Previous</button>
                <button type="button" id="next-step" class="btn btn-primary">Next Step</button>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script type="module">
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCXGpGiAaXwWMt-UoMl0hgBVxKddRHN8n0",
            authDomain: "careluva-5635e.firebaseapp.com",
            projectId: "careluva-5635e",
            storageBucket: "careluva-5635e.firebasestorage.app",
            messagingSenderId: "819482287777",
            appId: "1:819482287777:web:7587b10272cacc0e655ae0",
            measurementId: "G-9DL8W0Q6PB"
        };

        // Import Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";

        try {
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            const analytics = getAnalytics(app);

            // Make available globally
            window.firebase = { app, auth, db, analytics };
            window.firebaseReady = true;

            console.log('✅ Firebase initialized successfully!');
            
            // Dispatch custom event to notify other scripts
            window.dispatchEvent(new CustomEvent('firebaseReady'));
            
        } catch (error) {
            console.error('❌ Firebase initialization failed:', error);
            window.firebaseReady = false;
            window.dispatchEvent(new CustomEvent('firebaseError', { detail: error }));
        }
    </script>

    <script>
        let firebaseReady = false;
        let currentStep = 1;
        const totalSteps = 5;
        
        // Wait for Firebase
        window.addEventListener('firebaseReady', () => {
            firebaseReady = true;
            console.log('Firebase ready for provider registration');
        });
        
        function updateProgressBar() {
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.toggle('active', index < currentStep);
            });
        }
        
        function showStep(step) {
            console.log('=== showStep called with step:', step, '===');
            
            // Hide all steps
            const allSteps = document.querySelectorAll('.form-step');
            console.log('Found', allSteps.length, 'form steps');
            
            allSteps.forEach((stepEl, index) => {
                stepEl.classList.remove('active');
                stepEl.style.display = 'none';
                console.log(`Hiding step ${index + 1}:`, stepEl.dataset.step, stepEl);
            });
            
            // Show current step
            const currentStepEl = document.querySelector(`[data-step="${step}"]`);
            if (currentStepEl) {
                currentStepEl.classList.add('active');
                currentStepEl.style.display = 'block';
                currentStepEl.style.visibility = 'visible';
                currentStepEl.style.opacity = '1';
                console.log('✅ Showing step element:', currentStepEl);
                console.log('Step classes:', currentStepEl.className);
                console.log('Step style display:', currentStepEl.style.display);
            } else {
                console.error('❌ Step element not found for step:', step);
                console.log('Available steps:', Array.from(allSteps).map(s => s.dataset.step));
            }
            
            // Update buttons
            const prevBtn = document.getElementById('prev-step');
            const nextBtn = document.getElementById('next-step');
            
            console.log('Updating buttons for step:', step);
            console.log('Prev button found:', !!prevBtn);
            console.log('Next button found:', !!nextBtn);
            
            if (prevBtn) {
                prevBtn.disabled = step === 1;
                console.log('Prev button disabled:', prevBtn.disabled);
            }
            
            if (nextBtn) {
                if (step === totalSteps) {
                    nextBtn.textContent = 'Complete Registration';
                    nextBtn.style.background = '#10b981';
                    console.log('Next button text set to: Complete Registration');
                } else {
                    nextBtn.textContent = 'Next Step';
                    nextBtn.style.background = '#3b82f6';
                    console.log('Next button text set to: Next Step');
                }
            }
            
            updateProgressBar();
        }
        
        function collectFormData() {
            const formData = {};
            
            // Step 1: Basic Information
            formData.providerType = document.getElementById('provider-type').value;
            formData.clinicName = document.getElementById('clinic-name').value;
            formData.contactPerson = document.getElementById('contact-person').value;
            formData.email = document.getElementById('email').value;
            formData.phone = document.getElementById('phone').value;
            formData.address = document.getElementById('address').value;
            formData.city = document.getElementById('city').value;
            formData.country = document.getElementById('country').value;
            
            // Step 2: Medical Credentials
            formData.medicalLicense = document.getElementById('medical-license').value;
            formData.specialization = document.getElementById('specialization').value;
            formData.experienceYears = document.getElementById('experience-years').value;
            formData.licenseFile = document.getElementById('license-file').files.length > 0 ? 
                `${document.getElementById('license-file').files.length} file(s) uploaded` : 'Not provided';
            
            // Step 3: Verification
            formData.malpracticeInsurance = document.getElementById('malpractice-insurance').files.length > 0 ? 
                `${document.getElementById('malpractice-insurance').files.length} file(s) uploaded` : 'Not provided';
            formData.businessLicense = document.getElementById('business-license').files.length > 0 ? 
                `${document.getElementById('business-license').files.length} file(s) uploaded` : 'Not provided';
            formData.clinicPhotos = document.getElementById('clinic-photos').files.length > 0 ? 
                `${document.getElementById('clinic-photos').files.length} file(s) uploaded` : 'Not provided';
            formData.website = document.getElementById('website').value || 'Not provided';
            
            // Languages
            const languageCheckboxes = document.querySelectorAll('input[name="languages"]:checked');
            formData.languages = languageCheckboxes.length > 0 ? 
                Array.from(languageCheckboxes).map(cb => cb.value).join(', ') : 'Not provided';
            
            // Step 4: Account
            formData.password = document.getElementById('password').value;
            formData.termsAccepted = document.getElementById('terms-accepted').checked ? 'Yes' : 'No';
            formData.marketingConsent = document.getElementById('marketing-consent').checked ? 'Yes' : 'No';
            
            return formData;
        }
        
        function populateReviewStep() {
            const formData = collectFormData();
            const reviewContent = document.getElementById('review-content');
            
            const formatValue = (value) => {
                if (!value || value === '' || value === 'Not provided') return 'Not provided';
                if (value.includes('-')) {
                    return value.split('-').map(word => 
                        word.charAt(0).toUpperCase() + word.slice(1)
                    ).join(' ');
                }
                return value;
            };
            
            reviewContent.innerHTML = `
                <div class="review-group">
                    <h4>Basic Information</h4>
                    <div class="review-grid">
                        <div class="review-item">
                            <span class="review-label">Provider Type:</span>
                            <span class="review-value">${formatValue(formData.providerType)}</span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Clinic Name:</span>
                            <span class="review-value">${formData.clinicName || 'Not provided'}</span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Contact Person:</span>
                            <span class="review-value">${formData.contactPerson || 'Not provided'}</span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Email:</span>
                            <span class="review-value">${formData.email || 'Not provided'}</span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Phone:</span>
                            <span class="review-value">${formData.phone || 'Not provided'}</span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">City:</span>
                            <span class="review-value">${formData.city || 'Not provided'}</span>
                        </div>
                    </div>
                </div>
                
                <div class="review-group">
                    <h4>Medical Credentials</h4>
                    <div class="review-grid">
                        <div class="review-item">
                            <span class="review-label">License:</span>
                            <span class="review-value">${formData.medicalLicense || 'Not provided'}</span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Specialization:</span>
                            <span class="review-value">${formatValue(formData.specialization)}</span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Experience:</span>
                            <span class="review-value">${formData.experienceYears || 0} years</span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">License File:</span>
                            <span class="review-value">${formData.licenseFile}</span>
                        </div>
                    </div>
                </div>
                
                <div class="review-group">
                    <h4>Verification Documents</h4>
                    <div class="review-grid">
                        <div class="review-item">
                            <span class="review-label">Insurance:</span>
                            <span class="review-value">${formData.malpracticeInsurance}</span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Business License:</span>
                            <span class="review-value">${formData.businessLicense}</span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Clinic Photos:</span>
                            <span class="review-value">${formData.clinicPhotos}</span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Website:</span>
                            <span class="review-value">${formData.website}</span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Languages:</span>
                            <span class="review-value">${formData.languages}</span>
                        </div>
                    </div>
                </div>
                
                <div class="review-group">
                    <h4>Account Information</h4>
                    <div class="review-grid">
                        <div class="review-item">
                            <span class="review-label">Terms Accepted:</span>
                            <span class="review-value">${formData.termsAccepted}</span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Marketing Consent:</span>
                            <span class="review-value">${formData.marketingConsent}</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showMessage(message, type = 'error') {
            const messagesContainer = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            messagesContainer.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 5000);
        }
        
        function clearMessages() {
            document.getElementById('messages').innerHTML = '';
        }
        
        // Event listeners will be attached after DOM is loaded
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing provider registration form...');
            console.log('Total steps:', totalSteps);
            console.log('Current step:', currentStep);
            
            // Check if form elements exist
            const formSteps = document.querySelectorAll('.form-step');
            console.log('Found form steps:', formSteps.length);
            formSteps.forEach((step, index) => {
                console.log(`Step ${index + 1}:`, step.dataset.step, step);
                console.log('Step classes:', step.className);
                console.log('Step style:', step.style.display);
            });
            
            // Force show first step
            const firstStep = document.querySelector('[data-step="1"]');
            if (firstStep) {
                firstStep.style.display = 'block';
                firstStep.style.visibility = 'visible';
                firstStep.style.opacity = '1';
                firstStep.classList.add('active');
                console.log('Forced first step to be visible');
            }
            
            showStep(1);
            
            // Attach event listeners after DOM is ready
            const nextBtn = document.getElementById('next-step');
            const prevBtn = document.getElementById('prev-step');
            
            console.log('Attaching event listeners...');
            console.log('Next button found:', !!nextBtn);
            console.log('Prev button found:', !!prevBtn);
            
            if (nextBtn) {
                nextBtn.addEventListener('click', async () => {
                    console.log('Next button clicked, current step:', currentStep);
                    if (currentStep < totalSteps) {
                        currentStep++;
                        console.log('Moving to step:', currentStep);
                        if (currentStep === totalSteps) {
                            populateReviewStep();
                        }
                        showStep(currentStep);
                    } else {
                        // Final submission
                        nextBtn.disabled = true;
                        nextBtn.textContent = 'Submitting...';
                        clearMessages();
                        
                        try {
                            const formData = collectFormData();
                            
                            if (!firebaseReady) {
                                throw new Error('Firebase not ready');
                            }
                            
                            const { collection, addDoc, serverTimestamp } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js');
                            
                            const registrationData = {
                                // Basic Information
                                providerType: formData.providerType,
                                clinicName: formData.clinicName,
                                contactPerson: formData.contactPerson,
                                email: formData.email,
                                phone: formData.phone,
                                address: formData.address,
                                city: formData.city,
                                country: formData.country,
                                
                                // Medical Credentials
                                medicalLicense: formData.medicalLicense,
                                specialization: formData.specialization,
                                experienceYears: parseInt(formData.experienceYears) || 0,
                                
                                // Verification
                                website: formData.website,
                                languages: formData.languages,
                                
                                // Account
                                password: formData.password,
                                termsAccepted: formData.termsAccepted === 'Yes',
                                marketingConsent: formData.marketingConsent === 'Yes',
                                
                                // Metadata
                                status: 'pending',
                                registrationDate: serverTimestamp(),
                                lastUpdated: serverTimestamp()
                            };
                            
                            const docRef = await addDoc(collection(window.firebase.db, 'providerRegistrations'), registrationData);
                            
                            showMessage(`Registration completed successfully! Your registration ID: ${docRef.id}`, 'success');
                            
                            // Redirect to dashboard after 3 seconds
                            setTimeout(() => {
                                window.location.href = 'provider-dashboard.html';
                            }, 3000);
                            
                        } catch (error) {
                            console.error('Registration error:', error);
                            showMessage(`Registration failed: ${error.message}`);
                        } finally {
                            nextBtn.disabled = false;
                            nextBtn.textContent = 'Complete Registration';
                        }
                    }
                });
                console.log('✅ Next button event listener attached');
            } else {
                console.error('❌ Next button not found!');
            }
            
            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    console.log('Prev button clicked, current step:', currentStep);
                    if (currentStep > 1) {
                        currentStep--;
                        console.log('Moving to step:', currentStep);
                        showStep(currentStep);
                    }
                });
                console.log('✅ Prev button event listener attached');
            } else {
                console.error('❌ Prev button not found!');
            }
        });
    </script>
</body>
</html>
